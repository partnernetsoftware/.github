#include <stdio.h>
#include <stdlib.h>

int main(int argc, char *argv[]) {
    FILE *in, *out;
    int c;

    if (argc != 3) {
        fprintf(stderr, "Usage: %s input.h output_.h\n", argv[0]);
        return 1;
    }

    in = fopen(argv[1], "r");
    if (!in) {
        perror(argv[1]);
        return 1;
    }

    out = fopen(argv[2], "w");
    if (!out) {
        perror(argv[2]);
        fclose(in);
        return 1;
    }

    fprintf(out, "/* This file is automatically generated from %s */\n", argv[1]);
    fprintf(out, "\"");

    while ((c = fgetc(in)) != EOF) {
        if (c == '"') {
            fprintf(out, "\\\"");
        } else if (c == '\\') {
            fprintf(out, "\\\\");
        } else if (c == '\n') {
            fprintf(out, "\\n\"\n\"");
        } else if (c == '\r') {
            /* skip carriage return */
        } else {
            fputc(c, out);
        }
    }

    fprintf(out, "\"\n");

    fclose(in);
    fclose(out);

    return 0;
}
